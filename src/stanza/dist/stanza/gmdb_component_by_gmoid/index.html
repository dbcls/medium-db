

<script src="../assets/js/stanza.js"></script>
<script>
  (function() {
    const descriptor = {"templates":{"stanza.html":"\u003clink rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css\"\u003e\n\u003cstyle\u003e\n  @import url('https://fonts.googleapis.com/css2?family=Fira+Sans+Condensed:wght@300;600\u0026display=swap');\n\u003c/style\u003e\n\n\u003cstyle\u003e\n  .wrapper {\n    font-size: 18px;\n    font-family: 'Fira Sans Condensed', sans-serif;\n    padding: 16px;\n    background-color: #ffffff;\n    border-radius: 5px;\n    font-weight: 300;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: antialiased;\n    font-smoothing: antialiased;\n    color: #333;\n    box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);\n  }\n\u003c/style\u003e\n\n\u003cdiv class=\"wrapper\"\u003e\n  {{#if error}}\n    \u003cp\u003e{{msg}}\u003c/p\u003e\n  {{/if}}\n\n  {{#unless error}}\n    \u003cp\u003e{{result.gmo_id}}: {{result.pref_label}}\u003c/p\u003e\n\n    Alternative Labels\n    \u003ctable\u003e\n      {{#each result.alt_labels_en}}\n        \u003ctr\u003e\n          \u003ctd\u003e{{value}}\u003c/td\u003e\n        \u003c/tr\u003e\n      {{/each}}\n      \u003ctr\u003e\n        \u003ctd\u003eProperty\u003c/td\u003e\n        \u003ctd\u003e\n          {{#each result.properties}}\n            \u003ca href=\"http://growthmedium.org/vocab/{{gmo_id}}\"\u003e{{label_en}} \u003c/a\u003e\n          {{/each}}\n        \u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n        \u003ctd\u003eFunction\u003c/td\u003e\n        \u003ctd\u003e\n          {{#each result.roles}}\n            \u003ca href=\"http://growthmedium.org/component/{{gmo_id}}\"\u003e{{label_en}} \u003c/a\u003e\n          {{/each}}\n        \u003c/td\u003e\n      \u003c/tr\u003e\n      {{#each result.super_classes}}\n        \u003ctr\u003e\n          \u003ctd\u003e{{label}}\u003c/td\u003e\n          \u003ctd\u003e\n            \u003ca href=\"http://growthmedium.org/component/{{gmo_id}}\"\u003e{{gmo_id}}\u003c/a\u003e\n            : {{label_en}}\u003c/td\u003e\n        \u003c/tr\u003e\n      {{/each}}\n      {{#each result.sub_classes}}\n        \u003ctr\u003e\n          \u003ctd\u003e{{label}}\u003c/td\u003e\n          \u003ctd\u003e\n            \u003ca href=\"http://growthmedium.org/component/{{gmo_id}}\"\u003e{{gmo_id}}\u003c/a\u003e\n            : {{label_en}}\u003c/td\u003e\n        \u003c/tr\u003e\n      {{/each}}\n      \u003ctr\u003e\n        \u003ctd\u003eLink\u003c/td\u003e\n        \u003ctd\u003e\n          {{#each result.links}}\n            \u003ca href=\"{{uri}}\"\u003e{{label}} \u003c/a\u003e\n          {{/each}}\n        \u003c/td\u003e\n      \u003c/tr\u003e\n    \u003c/table\u003e\n  {{/unless}}\n\u003c/div\u003e\n"},"parameters":["gmo_id"],"elementName":"togostanza-gmdb_component_by_gmoid","development":false};

    if ('Promise' in window && 'URLSearchParams' in window && 'fetch' in window) {
      const Stanza = TogoStanza.initialize(descriptor);

      Stanza(function(stanza, params){

  const api_name = "gmdb_component_by_gmoid";
  const api_url = "http://ep.dbcls.jp/sparqlist/api/";
  const options = makeOptions(params);
  const data = {};
  let msg = "";
  let error = false;

  if(!params["gmo_id"]){
    error = true;
    msg = "gmo_id (e.g. GMO_001010) is required";
  }


  fetch(api_url + api_name, options)
    .then(res => res.json())
    .then(json => success(json))
    .catch(error => fail())
    .finally(() => {
      stanza.render({
        template: "stanza.html",
        parameters: {
          result: data,
          msg: msg,
          error: error
        }
      });
    });


  function success(json){
    data.alt_labels_en = [];
    data.alt_labels_ja = [];
    data.super_classes = [];
    data.sub_classes = [];
    data.links = [];
    data.properties = [];
    data.roles = [];

    data.gmo_id = json.id;
    data.pref_label = json.pref_label;
    data.json_label_ja = json.label_ja;

    /*
     if(json.alt_labels_en){
     for(let i = 0; i < json.alt_labels_en.length; i++){
     if(i == 0){
     data.alt_labels_en.push({
     "label": "Alternative label",
     "value": json.alt_labels_en[i]
     });
     }else{
     data.alt_labels_en.push({
     "label": "",
     "value": json.alt_labels_en[i]
     });
     }
     }
     }*/
    if(json.alt_labels_en){
      data.alt_labels_en = json.alt_labels_en.map(str => ({value: str}));
    }
    if(json.super_classes){
      for(let i = 0; i < json.super_classes.length; i++){
        if(i == 0){
          data.super_classes.push({
            "label": "Super class",
            "gmo_id": json.super_classes[i].gmo_id,
            "uri": json.super_classes[i].uri,
            "label_en": json.super_classes[i].label_en
          });
        }else{
          data.super_classes.push({
            "label": "",
            "gmo_id": json.super_classes[i].gmo_id,
            "uri": json.super_classes[i].uri,
            "label_en": json.super_classes[i].label_en
          });
        }
      }
    }
    /*
     if(json.super_classes){
     data.super_classes = json.super_classes.map(obj => ({
     gmo_id: obj.gmo_id,
     uri: obj.uri,
     label_en: obj.label_en
     }));
     }

     */
    if(json.sub_classes){
      for(let i = 0; i < json.sub_classes.length; i++){
        if(i == 0){
          data.sub_classes.push({
            "label": "Sub class",
            "gmo_id": json.sub_classes[i].gmo_id,
            "uri": json.sub_classes[i].uri,
            "label_en": json.sub_classes[i].label_en
          });
        }else{
          data.sub_classes.push({
            "label": "",
            "gmo_id": json.sub_classes[i].gmo_id,
            "uri": json.sub_classes[i].uri,
            "label_en": json.sub_classes[i].label_en
          });
        }
      }
    }
    if(json.links){
      for(let i = 0; i < json.links.length; i++){
        let link = json.links[i];
        switch(true){
          case /pccompound/.test(link):
            data.links.push({
              "label": "PubChem",
              "uri": json.links[i]
            });
            break;
          case /wikipedia/.test(link):
            data.links.push({
              "label": "Wikipedia",
              "uri": json.links[i]
            });
            break;
          case /ncicb/.test(link):
            data.links.push({
              "label": "NCI Thesaurus",
              "uri": json.links[i]
            });
            break;
          case /CHEBI/.test(link):
            data.links.push({
              "label": "ChEBI",
              "uri": json.links[i]
            });
            break;
          case /SNOMEDCT/.test(link):
            data.links.push({
              "label": "SNOMED-CT",
              "uri": json.links[i]
            });
            break;
        }
      }
    }
    if(json.properties){
      for(let i = 0; i < json.properties.length; i++){
        data.properties.push(json.properties[i]);
      }
    }
    if(json.roles){
      for(let i = 0; i < json.roles.length; i++){
        data.roles.push(json.roles[i]);
      }
    }


  }

  function fail(){
    error = true;
    const gmo_id = params["gmo_id"];
    msg = `Not found. gmo_id: ${gmo_id}`;
  }
});

function makeOptions(params){
  let formBody = [];

  for(let key in params){
    if(params[key]){
      formBody.push(key + "=" + encodeURIComponent(params[key]));
    }
  }

  return {
    method: "POST",
    mode: "cors",
    body: formBody.join("&"),
    headers: {
      "Accept": "application/json",
      "Content-Type": "application/x-www-form-urlencoded"
    }
  };
}

    } else {
      const element = document.querySelector(descriptor.elementName);

      element.innerHTML = "<p>Your Web browser does not support the features required for the stanza to work. If you are using Internet Explorer 11, placing the following snippet before loading webcomponents-loader.js may resolve this issue:</p>\n<pre><code>&lt;script src=\"https://cdn.jsdelivr.net/combine/npm/@babel/polyfill@7.2.5/dist/polyfill.min.js,npm/@ungap/url-search-params@0.1.2/min.js,npm/whatwg-fetch@3.0.0/dist/fetch.umd.js\" crossorigin&gt;&lt;/script&gt;</code></pre>";
    }
  })();
</script>
