

<script src="../assets/js/stanza.js"></script>
<script>
  (function() {
    const descriptor = {"templates":{"stanza.html":"\u003cp\u003e{{result.body.gmo_id}}: {{result.body.pref_label}}\u003c/p\u003e\n\n\u003ctable\u003e\n{{#each result.body.alt_labels_en}}\n\u003ctr\u003e\n  \u003ctd\u003e{{label}}\u003c/td\u003e\n  \u003ctd\u003e{{value}}\u003c/td\u003e\n\u003c/tr\u003e\n{{/each}}\n\u003ctr\u003e\n  \u003ctd\u003eProperty\u003c/td\u003e\n  \u003ctd\u003e\n  {{#each result.body.properties}}\n  \u003ca href=\"http://growthmedium.org/vocab/{{gmo_id}}\"\u003e{{label_en}} \u003c/a\u003e\n  {{/each}}\n  \u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n  \u003ctd\u003eFunction\u003c/td\u003e\n  \u003ctd\u003e\n  {{#each result.body.roles}}\n  \u003ca href=\"http://growthmedium.org/component/{{gmo_id}}\"\u003e{{label_en}} \u003c/a\u003e\n  {{/each}}\n  \u003c/td\u003e\n\u003c/tr\u003e\n{{#each result.body.super_classes}}\n\u003ctr\u003e\n  \u003ctd\u003e{{label}}\u003c/td\u003e\n  \u003ctd\u003e\u003ca href=\"http://growthmedium.org/component/{{gmo_id}}\"\u003e{{gmo_id}}\u003c/a\u003e: {{label_en}}\u003c/td\u003e\n\u003c/tr\u003e\n{{/each}}\n{{#each result.body.sub_classes}}\n\u003ctr\u003e\n  \u003ctd\u003e{{label}}\u003c/td\u003e\n  \u003ctd\u003e\u003ca href=\"http://growthmedium.org/component/{{gmo_id}}\"\u003e{{gmo_id}}\u003c/a\u003e: {{label_en}}\u003c/td\u003e\n\u003c/tr\u003e\n{{/each}}\n\u003ctr\u003e\n  \u003ctd\u003eLink\u003c/td\u003e\n  \u003ctd\u003e\n  {{#each result.body.links}}\n  \u003ca href=\"{{uri}}\"\u003e{{label}} \u003c/a\u003e\n  {{/each}}\n  \u003c/td\u003e\n\u003c/tr\u003e\n\u003c/table\u003e\n"},"parameters":["gmo_id"],"elementName":"togostanza-gmdb_component_by_gmoid","development":false};

    if ('Promise' in window && 'URLSearchParams' in window && 'fetch' in window) {
      const Stanza = TogoStanza.initialize(descriptor);

      Stanza(function(stanza, params) {

  let formBody = [];

  for (let key in params) {
    if (params[key]) {
      formBody.push(key + "=" + endocdeURIComponent(params[key]));
    }
  };

  const options = {
    method: "POST",
    mode: "cors",
    body: formBody.join("&"),
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/x-www-form-urlencoded'
    }
  };

  let api_url = "http://ep.dbcls.jp/sparqlist/api/";
  let api_name = "gmdb_component_by_gmoid";

  let q = fetch(api_url + api_name, options).then(res=>res.json());

  console.log(q);
  q.then(function(json) {
    let data = {};
    data.body = {};
    data.body.alt_labels_en = [];
    data.body.alt_labels_ja = [];
    data.body.super_classes = [];
    data.body.sub_classes = [];
    data.body.links = [];
    data.body.properties = [];
    data.body.roles = [];

    data.body.gmo_id = json.id;
    data.body.pref_label = json.pref_label;
    data.body.json_label_ja = json.label_ja;

    if (json.alt_labels_en) {
      for (let i = 0; i < json.alt_labels_en.length; i++) {
        if (i == 0) {
          data.body.alt_labels_en.push({"label": "Alternative label",
                                        "value": json.alt_labels_en[i]});
        } else {
          data.body.alt_labels_en.push({"label": "",
                                        "value": json.alt_labels_en[i]});
        }
      }
    }
    if (json.super_classes) { 
      for (let i = 0; i < json.super_classes.length; i++) {
        if (i == 0) {
          data.body.super_classes.push({"label": "Super class",
                                        "gmo_id": json.super_classes[i].gmo_id,
                                        "uri": json.super_classes[i].uri,
                                        "label_en": json.super_classes[i].label_en});
        } else {
          data.body.super_classes.push({"label": "",
                                        "gmo_id": json.super_classes[i].gmo_id,
                                        "uri": json.super_classes[i].uri,
                                        "label_en": json.super_classes[i].label_en});
        }
      }
    }
    if (json.sub_classes) {
      for (let i = 0; i < json.sub_classes.length; i++) {
        if (i == 0) {
          data.body.sub_classes.push({"label": "Sub class",
                                      "gmo_id": json.sub_classes[i].gmo_id,
                                      "uri": json.sub_classes[i].uri,
                                      "label_en": json.sub_classes[i].label_en});
        } else {
          data.body.sub_classes.push({"label": "",
                                      "gmo_id": json.sub_classes[i].gmo_id,
                                      "uri": json.sub_classes[i].uri,
                                      "label_en": json.sub_classes[i].label_en});
        }
      }
    }
    if (json.links) {
      for (let i = 0; i < json.links.length; i++) {
        let link = json.links[i];
        switch(true) {
        case /pccompound/.test(link):
          data.body.links.push({"label": "PubChem",
                                "uri": json.links[i]});
          break;
        case /wikipedia/.test(link):
          data.body.links.push({"label": "Wikipedia",
                                "uri": json.links[i]});
          break;
        case /ncicb/.test(link):
          data.body.links.push({"label": "NCI Thesaurus",
                                "uri": json.links[i]});
          break;
        case /CHEBI/.test(link):
          data.body.links.push({"label": "ChEBI",
                                "uri": json.links[i]});
          break;
        case /SNOMEDCT/.test(link):
          data.body.links.push({"label": "SNOMED-CT",
                                "uri": json.links[i]});
          break;
        }
      }
    }
    if (json.properties) {
      for (let i = 0; i < json.properties.length; i++) {
        data.body.properties.push(json.properties[i]);
      }
    }
    if (json.roles) { 
      for (let i = 0; i < json.roles.length; i++) {
        data.body.roles.push(json.roles[i]);
      }
    }

    stanza.render({
      template: "stanza.html",
      parameters: {
        result: data
      }
    });
  });
});

    } else {
      const element = document.querySelector(descriptor.elementName);

      element.innerHTML = "<p>Your Web browser does not support the features required for the stanza to work. If you are using Internet Explorer 11, placing the following snippet before loading webcomponents-loader.js may resolve this issue:</p>\n<pre><code>&lt;script src=\"https://cdn.jsdelivr.net/combine/npm/@babel/polyfill@7.2.5/dist/polyfill.min.js,npm/@ungap/url-search-params@0.1.2/min.js,npm/whatwg-fetch@3.0.0/dist/fetch.umd.js\" crossorigin&gt;&lt;/script&gt;</code></pre>";
    }
  })();
</script>
