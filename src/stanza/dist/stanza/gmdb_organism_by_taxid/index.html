

<script src="../assets/js/stanza.js"></script>
<script>
  (function() {
    const descriptor = {"templates":{"stanza.html":"\u003ctable\u003e\n  \u003ctr\u003e\n    \u003ctd\u003eName\u003c/td\u003e\n    \u003ctd\u003e{{result.body.scientific_name}}\u003c/td\u003e\n  \u003c/tr\u003e\n  \u003ctr\u003e\n    \u003ctd\u003eTaxonomy ID\u003c/td\u003e\n    \u003ctd\u003e{{result.body.taxid}} [\n      \u003ca href=\"https://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?mode=Info\u0026id={{result.body.taxid}}\"\u003eNCBI\u003c/a\u003e], [\n      \u003ca href=\"http://togogenome.org/organism/{{result.body.taxid}}\"\u003eTogoGenome\u003c/a\u003e\n      ]\n    \u003c/td\u003e\n  \u003c/tr\u003e\n  \u003ctr\u003e\n    \u003ctd\u003eAuthority name\u003c/td\u003e\n    \u003ctd\u003e{{result.body.authority_name}}\u003c/td\u003e\n  \u003c/tr\u003e\n\u003c/table\u003e\n\u003ch3\u003eLINEAGE\u003c/h3\u003e\n\u003cul\u003e\n  {{#each result.body.lineage}}\n    \u003cli\u003e\n      \u003cspan\u003e{{rank}}:{{label}}\u003c/span\u003e\u003cbr\u003e\n      [\u003ca href=\"https://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?mode=Info\u0026id={{taxid}}\" target=\"_blank\"\u003eNCBI\u003c/a\u003e]\n    \u003c/li\u003e\n  {{/each}}\n\u003c/ul\u003e\n\u003c!--\u003ctable\u003e--\u003e\n\u003c!--  \u003ctr\u003e--\u003e\n\u003c!--    \u003ctd\u003ePhylum\u003c/td\u003e--\u003e\n\u003c!--    \u003ctd\u003eClass\u003c/td\u003e--\u003e\n\u003c!--    \u003ctd\u003eOrder\u003c/td\u003e--\u003e\n\u003c!--    \u003ctd\u003eFamily\u003c/td\u003e--\u003e\n\u003c!--  \u003c/tr\u003e--\u003e\n\u003c!--  \u003ctr\u003e--\u003e\n\u003c!--    \u003ctd\u003e{{result.body.phylum.label}} [--\u003e\n\u003c!--      \u003ca href=\"https://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?mode=Info\u0026id={{result.body.phylum.taxid}}--\u003e\n\u003c!--      \"\u003eNCBI\u003c/a\u003e]--\u003e\n\u003c!--    \u003c/td\u003e--\u003e\n\u003c!--    \u003ctd\u003e{{result.body.class.label}} [--\u003e\n\u003c!--      \u003ca href=\"https://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?mode=Info\u0026id={{result.body.class.taxid}}--\u003e\n\u003c!--      \"\u003eNCBI\u003c/a\u003e]--\u003e\n\u003c!--    \u003c/td\u003e--\u003e\n\u003c!--    \u003ctd\u003e{{result.body.order.label}} [--\u003e\n\u003c!--      \u003ca href=\"https://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?mode=Info\u0026id={{result.body.order.taxid}}--\u003e\n\u003c!--      \"\u003eNCBI\u003c/a\u003e]--\u003e\n\u003c!--    \u003c/td\u003e--\u003e\n\u003c!--    \u003ctd\u003e{{result.body.family.label}} [--\u003e\n\u003c!--      \u003ca href=\"https://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?mode=Info\u0026id={{result.body.family.taxid}}--\u003e\n\u003c!--      \"\u003eNCBI\u003c/a\u003e]--\u003e\n\u003c!--    \u003c/td\u003e--\u003e\n\u003c!--  \u003c/tr\u003e--\u003e\n\u003c!--\u003c/table\u003e--\u003e\n\n\u003cp\u003eType strains\u003c/p\u003e\n\u003ctable\u003e\n  {{#each result.body.type_material}}\n    \u003ctr\u003e\n      \u003ctd\u003e{{label}}\u003c/td\u003e\n    \u003c/tr\u003e\n  {{/each}}\n\u003c/table\u003e\n"},"parameters":["query"],"elementName":"togostanza-gmdb_organism_by_taxid","development":false};

    if ('Promise' in window && 'URLSearchParams' in window && 'fetch' in window) {
      const Stanza = TogoStanza.initialize(descriptor);

      Stanza(function(stanza, params){
  const query = params["query"];

  let options = {
    method: "POST",
    mode: "cors",
    body: "",
    headers: {
      "Accept": "application/json",
      "Content-Type": "application/x-www-form-urlencoded"
    }
  };

  // console.log(query);
  let api_url = "http://ep.dbcls.jp/sparqlist/api/";
  let api_name = `gmdb_organism_by_taxid?taxid=${query}`;
  // let api_name = `gmdb_organism_by_taxid`;

  let q = fetch(api_url + api_name, options).then(res => res.json());

  q.then(function(json){
    let data = {};
    data.body = {};
    data.body.type_material = [];
    data.body.lineage = [];

    data.body.scientific_name = json.scientific_name;
    data.body.taxid = json.taxid;
    if(json.authority_name){
      data.body.authority_name = json.authority_name;
    }
    if(json.type_material){
      for(let i = 0; i < json.type_material.length; i++){
        data.body.type_material.push(json.type_material[i]);
      }
    }
    if(json.lineage){
      json.lineage.forEach(elm => data.body.lineage.push(elm));
    }
    /*
     ;
     data.body.phylum = {};
     data.body.phylum.uri = json.phylum.uri;
     data.body.phylum.label = json.phylum.label;
     data.body.phylum.taxid = json.phylum.taxid;
     data.body.order = {};
     data.body.order.uri = json.order.uri;
     data.body.order.label = json.order.label;
     data.body["class"] = {};
     data.body["class"].uri = json["class"].uri;
     data.body["class"].label = json["class"].label;
     data.body.family = {};
     data.body.family.uri = json.family.uri;
     data.body.family.label = json.family.label;
     */

    stanza.render({
      template: "stanza.html",
      parameters: {
        result: data
      }
    });
  });
});

    } else {
      const element = document.querySelector(descriptor.elementName);

      element.innerHTML = "<p>Your Web browser does not support the features required for the stanza to work. If you are using Internet Explorer 11, placing the following snippet before loading webcomponents-loader.js may resolve this issue:</p>\n<pre><code>&lt;script src=\"https://cdn.jsdelivr.net/combine/npm/@babel/polyfill@7.2.5/dist/polyfill.min.js,npm/@ungap/url-search-params@0.1.2/min.js,npm/whatwg-fetch@3.0.0/dist/fetch.umd.js\" crossorigin&gt;&lt;/script&gt;</code></pre>";
    }
  })();
</script>
